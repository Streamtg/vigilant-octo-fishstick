name: Puppeteer Video Traffic

on:
  workflow_dispatch:

jobs:
  visit-video:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        instance: [1]  # Solo 1 para prueba, luego amplÃ­as a 216
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Puppeteer
        run: npm install puppeteer

      - name: Run Puppeteer script
        run: |
          node -e "
          const puppeteer = require('puppeteer');
          (async () => {
            const url = 'https://rumble.com/v41bpuq-school-march-festival.html';
            const browser = await puppeteer.launch({ args: ['--no-sandbox', '--disable-setuid-sandbox'] });
            const page = await browser.newPage();

            try {
              await page.goto(url, { waitUntil: 'networkidle2', timeout: 90000 });
              for (let i = 0; i < 10; i++) {
                await page.click('.bigPlayUIInner.ctp');
                console.log(`Clicked play button iteration ${i + 1}`);
                await new Promise(r => setTimeout(r, 7000)); // esperar 7 segundos
              }
            } catch (e) {
              console.error('Error:', e);
            }
            await browser.close();
          })();
          "
