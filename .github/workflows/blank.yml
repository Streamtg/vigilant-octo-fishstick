name: Ejecutar Bot desde GitLab

on:
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: 🔄 Clonar repo desde GitLab
        run: |
          git clone https://gitlab.com/none342/urlarriba.git
          cd urlarriba
          echo "✅ Clonado completado"

      - name: 🐍 Instalar Python y dependencias
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip tmux
          cd urlarriba
          pip3 install --upgrade pip
          pip3 install -r requirements.txt

      - name: 🔐 Crear archivo .env con secretos
        run: |
          cd urlarriba
          echo "API_ID=${{ secrets.API_ID }}" >> .env
          echo "API_HASH=${{ secrets.API_HASH }}" >> .env
          echo "BOT_TOKEN=${{ secrets.BOT_TOKEN }}" >> .env
          echo "OWNER_ID=${{ secrets.OWNER_ID }}" >> .env
          echo "CHANNEL_ID=${{ secrets.CHANNEL_ID }}" >> .env

      - name: 🧠 Exportar variables de entorno
        run: |
          cd urlarriba
          export $(cat .env | xargs)

      - name: 🚀 Ejecutar bot con tmux
        run: |
          cd urlarriba
          python3 bot.py
