name: Visit Blog Human-Like

on:
  workflow_dispatch:

jobs:
  visit-blog:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        instance: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                   11, 12, 13, 14, 15, 16, 17, 18, 19, 20]

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install Puppeteer & Stealth
        run: |
          npm install puppeteer puppeteer-extra puppeteer-extra-plugin-stealth

      - name: Create visitBlog.js
        run: |
          cat << 'EOF' > visitBlog.js
          const puppeteer = require('puppeteer-extra');
          const StealthPlugin = require('puppeteer-extra-plugin-stealth');
          puppeteer.use(StealthPlugin());

          const userAgents = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 13_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15',
            'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:123.0) Gecko/20100101 Firefox/123.0',
            'Mozilla/5.0 (Linux; Android 13; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.101 Mobile Safari/537.36',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/121.0.6167.140 Mobile/15E148 Safari/604.1'
          ];

          const referers = [
            'https://www.google.com/',
            'https://www.facebook.com/',
            'https://twitter.com/',
            'https://www.reddit.com/',
            'https://www.bing.com/',
            'https://duckduckgo.com/'
          ];

          const getRandom = arr => arr[Math.floor(Math.random() * arr.length)];

          (async () => {
            const browser = await puppeteer.launch({
              headless: false,
              args: ['--no-sandbox', '--disable-setuid-sandbox']
            });

            const page = await browser.newPage();

            const userAgent = getRandom(userAgents);
            const referer = getRandom(referers);
            const width = 800 + Math.floor(Math.random() * 400);
            const height = 600 + Math.floor(Math.random() * 300);

            await page.setUserAgent(userAgent);
            await page.setExtraHTTPHeaders({ referer });
            await page.setViewport({ width, height });

            console.log('üß† User-Agent:', userAgent);
            console.log('üîó Referer:', referer);

            try {
              await page.goto('https://yoelmod.blogspot.com', { waitUntil: 'domcontentloaded', timeout: 60000 });

              // Simula scroll
              for (let i = 0; i < 4; i++) {
                await page.mouse.wheel({ deltaY: 300 + Math.random() * 200 });
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
              }

              // Mueve el mouse aleatoriamente
              await page.mouse.move(
                100 + Math.random() * 400,
                100 + Math.random() * 300
              );

              // Espera entre 20-40 segundos para simular permanencia
              const waitTime = 20000 + Math.random() * 20000;
              console.log(`‚è±Ô∏è Esperando ${(waitTime / 1000).toFixed(1)}s`);
              await new Promise(resolve => setTimeout(resolve, waitTime));

              console.log('‚úÖ Visita completada.');
            } catch (error) {
              console.error(`‚ùå Error: ${error.message}`);
            } finally {
              await browser.close();
            }
          })();
          EOF

      - name: Ejecutar visita simulada al blog
        run: node visitBlog.js
